<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f9f9f9;padding:20px;color:#004d40;}
    .contract-box{background:#fff;border:2px solid #004d40;padding:20px;border-radius:12px;margin-bottom:40px;}
    h2{text-align:center;margin-bottom:20px;color:#004d40;}
    .info-row{display:flex;justify-content:space-between;margin-bottom:10px;font-size:15px;}
    .info-row div{width:48%;}
    .btn-download{background:#00796b;color:#fff;padding:8px 20px;border:none;border-radius:6px;cursor:pointer;font-size:14px;}
    .btn-download:hover{background:#004d40;}
    .footer{text-align:center;margin-top:30px;font-size:13px;color:#555;}
    .confirmation-box{background:#e8f5e9;padding:15px;margin-top:30px;border-radius:10px;border:1px solid #4caf50;}
    .highlight{color:#c62828;font-weight:bold;}
  </style>
</head>
<body>

  <h2>Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h2>

  <div id="contractContainer" class="contract-box">
    <div style="text-align:center;font-weight:bold;font-size:20px;">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…</div>

    <div class="info-row" style="margin-top:20px;">
      <div>
        <div>Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
        <div>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</div>
        <div>ØªØ±Ø®ÙŠØµ Ø±Ù‚Ù…: 1100042624</div>
        <div>Ø§Ù„Ø±ÙŠØ§Ø¶</div>
      </div>
      <div style="text-align:left;">
        <div id="contractNo">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: </div>
        <div id="hijriDate">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: </div>
        <div id="timeNow">Ø§Ù„ÙˆÙ‚Øª: </div>
      </div>
    </div>

    <h3 style="text-align:center;margin-top:30px;">Ø¹Ù‚Ø¯ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ Ù…Ù† Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h3>

    <div id="clientData" style="margin-top:30px;"></div>

    <p style="margin-top:30px;" id="contractBody">
      Ù†Øµ ÙƒØ§Ù…Ù„ Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„ØªÙŠ ØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù…Ù† 1 Ø¥Ù„Ù‰ 12 Ø¨Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù…ÙŠ.
    </p>

    <div class="confirmation-box">
      <p><strong>ØµÙØ­Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</strong></p>
      <p>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…: <span id="confirmName"></span></p>
      <p>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: <span id="confirmID"></span></p>
      <p>ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯: <strong>Ù…ÙˆØ§ÙÙ‚</strong></p>
      <p style="color:green;font-weight:bold;">âœ… ØªÙ… Ø¥Ø¨Ø±Ø§Ù… Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ù†Ø¬Ø§Ø­</p>
    </div>

    <div style="margin-top:40px;">
      <p><strong>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„:</strong> ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¢Ù„ÙŠÙ‹Ø§ Ù…Ù† Ù†Ø§ÙŠÙ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ</p>
      <p><strong>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ:</strong> âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
    </div>

    <div style="background:#fff3cd;border:1px solid #ffeeba;padding:10px;border-radius:8px;margin-top:20px;font-size:14px;color:#856404;">
      âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø¯ ÙŠÙØ¹Ø¯ Ø³Ù†Ø¯Ù‹Ø§ ØªÙ†ÙÙŠØ°ÙŠÙ‹Ø§ ÙƒÙ…Ø§ Ù†ØµÙ‘Øª Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø§Ø¯Ø© (9) Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©
    </div>

    <div class="footer" id="footerTime">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„ÙˆÙ‚Øª...</div>
  </div>

  <div style="text-align:center;">
    <button class="btn-download" onclick="downloadPDF()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ PDF</button>
  </div>

  <script>
    function getNextContractNumber(){
      const start = 9876;
      let last = localStorage.getItem('lastContractNo');
      if(!last){ last = start; }
      const next = parseInt(last) + 1;
      localStorage.setItem('lastContractNo', next);
      return next;
    }
    const contractNumber = getNextContractNumber();
    document.getElementById('contractNo').textContent = 'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: ' + contractNumber;

    const sampleClient = JSON.parse(localStorage.getItem('currentClient') || '{}');
    if(!sampleClient.name){
      Object.assign(sampleClient,{
        name:'Ø³Ø¹ÙˆØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ',
        id:'1234567890',
        birth:'1405/01/01',
        mobile:'0501234567',
        location:'Ù„Ù… ÙŠØ³Ù…Ø­ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆÙ‚Ø¹Ù‡ ÙˆØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø¨Ù„Ù‡ ÙƒÙ…Ø§ ÙŠÙ„ÙŠ: Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ù„Ø¨Ù†'
      });
    }

    document.getElementById('clientData').innerHTML = `
      <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${sampleClient.name}</p>
      <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${sampleClient.id}</p>
      <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> ${sampleClient.birth}</p>
      <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</strong> ${sampleClient.mobile}</p>
      <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${sampleClient.location}</p>
      <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¯:</strong> âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
    `;

    document.getElementById('confirmName').textContent = sampleClient.name;
    document.getElementById('confirmID').textContent = sampleClient.id;

    async function updateDateTime(){
      const now = new Date();
      const time = now.toLocaleTimeString('ar-EG');
      try{
        const res = await fetch(`https://api.aladhan.com/v1/gToH?date=${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`);
        const hijri = (await res.json()).data.hijri.date;
        document.getElementById('hijriDate').textContent = 'Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ' + hijri;
        document.getElementById('timeNow').textContent  = 'Ø§Ù„ÙˆÙ‚Øª: ' + time;
        document.getElementById('footerTime').innerHTML = `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijri}<br>â° Ø§Ù„ÙˆÙ‚Øª: ${time}<br>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø±ÙƒØ© Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±`;
      }catch(e){
        document.getElementById('footerTime').textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®.';
      }
    }
    updateDateTime();

    function downloadPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:'p',unit:'pt',format:'a4'});
      doc.html(document.getElementById('contractContainer'),{
        callback:pdf=>pdf.save(`Ø¹Ù‚Ø¯_${contractNumber}.pdf`),
        x:10,y:10,html2canvas:{scale:0.75}
      });
    }
  </script>
</body>
</html>