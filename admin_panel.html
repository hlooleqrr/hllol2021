<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family:'Tajawal',sans-serif;background:#f9f9f9;padding:20px;color:#004d40; }
    h2 { text-align:center;color:#004d40; }
    .contract-box { background:#fff;border:2px solid #004d40;padding:20px;border-radius:12px;margin:20px 0; }
    .info-row { display:flex;justify-content:space-between;font-size:14px;margin-bottom:8px; }
    .btn-download { background:#00796b;color:#fff;padding:8px 18px;border:none;border-radius:6px;cursor:pointer;font-size:14px; }
    .btn-download:hover { background:#004d40; }
    .footer { text-align:center;margin-top:20px;font-size:13px;color:#555; }
  </style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø§Ù„Ø¹Ù‚ÙˆØ¯</h2>

<div id="contractsList"></div>

<script>
let contractStart = 9876;
let clients = JSON.parse(localStorage.getItem("clientsData") || "[]");

if (clients.length === 0) {
  document.getElementById("contractsList").innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
} else {
  clients.forEach((client, index) => {
    const contractNo = contractStart + index + 1;
    const div = document.createElement("div");
    div.className = "contract-box";
    div.innerHTML = `
      <div class="info-row">
        <div><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${client.name}</div>
        <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${client.id}</div>
      </div>
      <div class="info-row">
        <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</strong> ${contractNo}</div>
        <div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù‚Ø¯:</strong> ${client.date || 'â€”'}</div>
      </div>
      <div class="info-row">
        <div><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¯:</strong> ${client.status}</div>
        <div><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${client.time || 'â€”'}</div>
      </div>
      <div style="text-align:center;margin-top:10px;">
        <button class="btn-download" onclick="generatePDF(${index})">ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ Ø¨ØµÙŠØºØ© PDF</button>
      </div>
    `;
    document.getElementById("contractsList").appendChild(div);
  });
}

function generatePDF(index) {
  const client = clients[index];
  const contractNo = contractStart + index + 1;
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:'p', unit:'pt', format:'a4'});

  const content = `
    Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…\n\n
    Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©\n
    Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©\n
    ØªØ±Ø®ÙŠØµ Ø±Ù‚Ù…: 1100042624\n
    Ø§Ù„Ø±ÙŠØ§Ø¶\n\n

    Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: ${contractNo}
    Ø§Ù„ØªØ§Ø±ÙŠØ®: ${client.date || 'â€”'}  Ø§Ù„ÙˆÙ‚Øª: ${client.time || 'â€”'}

    Ø¹Ù‚Ø¯ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ Ù…Ù† Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©

    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:
    - Ø§Ù„Ø§Ø³Ù…: ${client.name}
    - Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${client.id}
    - ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯: ${client.birth}
    - Ø§Ù„Ø¬ÙˆØ§Ù„: ${client.mobile}
    - Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${client.location || 'Ù„Ù… ÙŠØ³Ù…Ø­ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆÙ‚Ø¹Ù‡ ÙˆØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹'}

    Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:
    ${client.answers ? client.answers.map(a => `â€¢ ${a.question}: âœ… ${a.answer}`).join('\n') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©'}

    Ø§Ù„Ø­Ø§Ù„Ø©: ${client.status === 'approved' ? 'âœ… ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯' : 'âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¹Ù‚Ø¯'}
    
    Ø§Ù„Ù…Ø§Ø¯Ø© 9: Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø¯ ÙŠÙØ¹Ø¯ Ø³Ù†Ø¯Ù‹Ø§ ØªÙ†ÙÙŠØ°ÙŠÙ‹Ø§ ÙƒÙ…Ø§ Ù†ØµØª Ø§Ù„Ù…Ø§Ø¯Ø© (9) Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©.

    Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¢Ù„ÙŠ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„: Ù†Ø§ÙŠÙ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ
    ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ: ${client.status === 'approved' ? 'âœ… Ù…ÙˆØ§ÙÙ‚' : 'âŒ ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚'}

    Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: Ø³ÙŠØªÙ… Ø·Ø¨Ø§Ø¹ØªÙ‡ Ù…Ù† Ø§Ù„ÙÙˆØªØ±
  `;

  doc.setFont('Arial');
  doc.setFontSize(12);
  doc.text(content, 30, 40, {maxWidth: 540});
  doc.save(`Ø¹Ù‚Ø¯_${client.name}.pdf`);
}
</script>

<div class="footer" id="footerTime">ğŸ“… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„ÙˆÙ‚Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...</div>

<script>
async function updateDateTime(){
  const now = new Date();
  const time = now.toLocaleTimeString('ar-EG');
  try {
    const res = await fetch(`https://api.aladhan.com/v1/gToH?date=${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`);
    const hijri = (await res.json()).data.hijri.date;
    document.getElementById("footerTime").innerHTML = `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijri}<br>â° Ø§Ù„ÙˆÙ‚Øª: ${time}<br>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø±ÙƒØ© Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±`;
  } catch {
    document.getElementById("footerTime").textContent = "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®.";
  }
}
updateDateTime();
</script>

</body>
</html>