<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø§Ù„Ø¹Ù‚ÙˆØ¯</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f5f5f5; padding: 30px; color: #004d40; }
    h1 { text-align: center; margin-bottom: 40px; }
    .client-box { background: white; border: 2px solid #004d40; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
    .client-box h3 { margin-top: 0; color: #00796b; }
    .btn-pdf { background-color: #004d40; color: white; padding: 8px 20px; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; }
    .btn-pdf:hover { background-color: #00796b; }
    .info-row { display: flex; justify-content: space-between; margin: 5px 0; }
    .label { font-weight: bold; }
  </style>
</head>
<body>

<h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯</h1>

<div id="clientsContainer"></div>

<script>
const clients = JSON.parse(localStorage.getItem('clientsList') || '[]');
const container = document.getElementById("clientsContainer");

clients.forEach((client, index) => {
  const box = document.createElement("div");
  box.className = "client-box";

  const contractNumber = 9876 + index + 1;
  const statusText = client.status === 'approved' ? 'âœ… ØªÙ…Ù‘Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©' : 'âŒ ØªÙ…Ù‘ Ø§Ù„Ø±ÙØ¶';

  box.innerHTML = `
    <h3>Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.name}</h3>
    <div class="info-row"><span class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</span> <span>${client.id}</span></div>
    <div class="info-row"><span class="label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</span> <span>${contractNumber}</span></div>
    <div class="info-row"><span class="label">Ø§Ù„ÙˆÙ‚Øª:</span> <span>${client.time}</span></div>
    <div class="info-row"><span class="label">Ø§Ù„Ø­Ø§Ù„Ø©:</span> <span>${statusText}</span></div>
    <button class="btn-pdf" onclick="generatePDF(${index})">ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ PDF</button>
  `;

  container.appendChild(box);
});
</script><script>
async function generatePDF(index) {
  const { jsPDF } = window.jspdf;
  const client = clients[index];
  const contractNumber = 9876 + index + 1;

  const now = new Date();
  const time = now.toLocaleTimeString('ar-EG');
  let hijriDate = '---';

  try {
    const res = await fetch(`https://api.aladhan.com/v1/gToH?date=${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`);
    hijriDate = (await res.json()).data.hijri.date;
  } catch (e) {
    hijriDate = 'ØªØ¹Ø°Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ù‡Ø¬Ø±ÙŠ';
  }

  const doc = new jsPDF({orientation: 'p', unit: 'pt', format: 'a4'});
  const lineHeight = 20;
  let y = 40;

  doc.setFont('helvetica', 'bold');
  doc.setFontSize(16);
  doc.text("Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…", 300, y, {align: "center"});

  y += 30;
  doc.setFontSize(12);
  doc.setFont('helvetica', 'normal');
  doc.text("Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©", 40, y);
  doc.text("Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯: " + contractNumber, 400, y);
  y += lineHeight;
  doc.text("Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©", 40, y);
  doc.text("Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: " + hijriDate, 400, y);
  y += lineHeight;
  doc.text("ØªØ±Ø®ÙŠØµ Ø±Ù‚Ù…: 1100042624", 40, y);
  doc.text("Ø§Ù„ÙˆÙ‚Øª: " + time, 400, y);
  y += lineHeight;
  doc.text("Ø§Ù„Ø±ÙŠØ§Ø¶", 40, y);

  y += 40;
  doc.setFontSize(14);
  doc.text("Ø¹Ù‚Ø¯ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ Ù…Ù† Ø¬Ù‡Ø© ØªÙ…ÙˆÙŠÙ„ÙŠØ©", 300, y, {align: "center"});

  y += 30;
  doc.setFontSize(12);
  doc.text(`Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.name}`, 40, y); y += lineHeight;
  doc.text(`Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${client.id}`, 40, y); y += lineHeight;
  doc.text(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${client.location || "Ù„Ù… ÙŠØ³Ù…Ø­ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ù…ÙˆÙ‚Ø¹Ù‡ ÙˆØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§"}`, 40, y); y += lineHeight;
  doc.text(`Ø§Ù„Ø­Ø§Ù„Ø©: ${client.status === "approved" ? "âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©" : "âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶"}`, 40, y); y += lineHeight;

  y += 20;
  doc.setFont('helvetica', 'bold');
  doc.text("Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¹Ù‚Ø¯:", 40, y);
  y += 20;
  doc.setFont('helvetica', 'normal');
  const terms = client.terms || [];
  terms.forEach((term, i) => {
    if (y > 750) { doc.addPage(); y = 40; }
    doc.text(`${i + 1}. ${term.text}`, 40, y); y += lineHeight;
    doc.text(`Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„: ${term.answer}`, 60, y); y += lineHeight;
  });

  y += 20;
  doc.text("ØªÙ… ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø¯ Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ø¢Ù„ÙŠÙ‹Ø§ - Ù†Ø§ÙŠÙ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ", 40, y); y += lineHeight;
  doc.text(`ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ: ${client.status === "approved" ? "âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©" : "âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶"}`, 40, y);

  y += 30;
  doc.setTextColor(133, 100, 4);
  doc.setFontSize(11);
  doc.text("âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø¯ ÙŠÙØ¹Ø¯ Ø³Ù†Ø¯Ù‹Ø§ ØªÙ†ÙÙŠØ°ÙŠÙ‹Ø§ ÙƒÙ…Ø§ Ù†ØµÙ‘Øª Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø§Ø¯Ø© (9) Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©", 40, y);
  y += 30;

  doc.setTextColor(85, 85, 85);
  doc.setFontSize(10);
  doc.text(`ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijriDate}`, 40, y); y += lineHeight;
  doc.text(`â° Ø§Ù„ÙˆÙ‚Øª: ${time}`, 40, y);
  doc.text("Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø±ÙƒØ© Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±", 300, 820, {align: "center"});

  doc.save(`Ø¹Ù‚Ø¯_${contractNumber}_${client.name}.pdf`);
}
</script>