<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>سرعة تملك العقار والحلول التمويلية المتكاملة</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Tajawal', sans-serif;
    background: #f9fafb;
    color: #004d40;
    display: flex;
    flex-direction: column;
  }
  .container {
    flex: 1;
    max-width: 650px;
    margin: auto;
    padding: 20px 30px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  header {
    text-align: center;
    margin-bottom: 25px;
  }
  header h1 {
    font-size: 3rem;
    font-weight: 800;
    color: #00332f;
    margin: 15px 0 10px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
  }
  header p {
    font-size: 1.3rem;
    font-weight: 600;
    color: #00796b;
  }
  .page {
    display: none;
    flex-direction: column;
  }
  .page.active {
    display: flex;
  }
  label {
    font-weight: 700;
    font-size: 1.2rem;
  }
  input[type=text], input[type=number] {
    width: 100%;
    font-size: 1rem;
    padding: 12px 15px;
    margin: 10px 0 20px;
    border-radius: 6px;
    border: 2px solid #009688;
    font-family: 'Tajawal', sans-serif;
    transition: border-color 0.3s ease;
  }
  input[type=text]:focus, input[type=number]:focus {
    outline: none;
    border-color: #004d40;
    box-shadow: 0 0 5px #004d40aa;
  }
  button {
    background-color: #00796b;
    color: #fff;
    border: none;
    padding: 16px 30px;
    font-size: 1.3rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    align-self: center;
    min-width: 160px;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  button:hover:not(:disabled) {
    background-color: #004d40;
  }
  button:disabled {
    background-color: #b2dfdb;
    cursor: not-allowed;
  }
  footer {
    text-align: center;
    font-size: 1rem;
    color: #d32f2f;
    padding: 12px 0;
    border-top: 1px solid #ddd;
    background-color: #fff0f0;
    font-weight: 700;
  }
  .contract-text {
    font-size: 1rem;
    line-height: 1.6;
    max-height: 470px;
    overflow-y: auto;
    border: 2px solid #009688;
    padding: 20px 25px;
    border-radius: 10px;
    background: #f6fdfd;
    margin-bottom: 25px;
    white-space: pre-wrap;
  }
  .notice {
    background-color: #b2dfdb;
    border-radius: 8px;
    padding: 16px 20px;
    font-weight: 700;
    color: #004d40;
    margin-bottom: 25px;
    text-align: center;
    white-space: pre-line;
  }
  .error-msg {
    color: #d32f2f;
    font-weight: 800;
    margin-top: 12px;
    text-align: center;
  }
  .btn-approve {
    background-color: #2e7d32;
  }
  .btn-approve:hover:not(:disabled) {
    background-color: #145214;
  }
  .btn-reject {
    background-color: #c62828;
  }
  .btn-reject:hover:not(:disabled) {
    background-color: #7b1a1a;
  }
  .icon {
    font-size: 1.5rem;
    line-height: 1;
  }
  #rejectMsg {
    margin-top: 20px;
    font-size: 1.2rem;
    color: #c62828;
    font-weight: 800;
    text-align: center;
  }
  input.inline-fill {
    border: none;
    border-bottom: 2px solid #004d40;
    font-weight: 700;
    font-size: 1rem;
    padding: 0 5px;
    min-width: 100px;
    max-width: 200px;
    background: transparent;
    text-align: center;
    margin: 0 3px;
  }
  input.inline-fill:focus {
    outline: none;
    border-color: #2e7d32;
    box-shadow: 0 0 4px #2e7d3288;
  }
  /* لضبط النص الذي يحوي الحقول ليتوافق */
  .contract-text span.inline-field {
    vertical-align: bottom;
  }
  @media (max-width: 480px) {
    header h1 {
      font-size: 2rem;
    }
    button {
      font-size: 1.1rem;
      padding: 14px 22px;
      min-width: 140px;
    }
    input.inline-fill {
      min-width: 80px;
      max-width: 140px;
      font-size: 0.9rem;
    }
  }
</style>
</head>
<body>

<div class="container">

  <!-- الصفحة 1 -->
  <section id="page1" class="page active" aria-label="الصفحة الأولى - مقدمة العقد">
    <header>
      <h1>سرعة تملك العقار<br> والحلول التمويلية المتكاملة</h1>
      <p>نرحب بك عميلنا العزيز</p>
    </header>
    <p style="font-size:1.2rem; line-height:1.6; text-align:center; margin-bottom:40px; font-weight:600;">
      نبرم معك هذا العقد<br><br>
      <strong>بسم الله الرحمن الرحيم</strong>
    </p>
    <button id="startBtn">التالي ➔</button>
  </section>

  <!-- الصفحة 2 -->
  <section id="page2" class="page" aria-label="الصفحة الثانية - بيانات العميل">
    <label for="fullName">الاسم الكريم:</label>
    <input type="text" id="fullName" name="fullName" autocomplete="name" placeholder="اكتب اسمك الكريم" required />
    <label for="idNumber">السجل المدني:</label>
    <input type="text" id="idNumber" name="idNumber" placeholder="أدخل رقم السجل المدني (10 أرقام)" maxlength="10" pattern="\d{10}" title="رقم السجل المدني مكون من 10 أرقام" required />
    <button id="toContractBtn" disabled>التالي ➔</button>
  </section>

  <!-- الصفحة 3 -->
  <section id="page3" class="page" aria-label="الصفحة الثالثة - عرض العقد">
    <div class="contract-text" id="contractText" tabindex="0" aria-live="polite" aria-label="نص العقد">
      <!-- سيتم تحديث النص مع الحقول -->
    </div>
    <button id="toApproveBtn" class="btn-approve">✓ موافق على العقد</button>
  </section>

  <!-- الصفحة 4 -->
  <section id="page4" class="page" aria-label="الصفحة الرابعة - الموافقة النهائية">
    <p style="font-weight:700; font-size:1.3rem; margin-bottom: 15px; text-align:center;">
      الرجاء تأكيد بياناتك لإتمام العقد
    </p>

    <label for="confirmId">رقم الهوية:</label>
    <input type="text" id="confirmId" name="confirmId" placeholder="أدخل رقم الهوية (10 أرقام)" maxlength="10" pattern="\d{10}" title="رقم الهوية مكون من 10 أرقام" required />

    <label for="approvalText">اكتب كلمة (موافق):</label>
    <input type="text" id="approvalText" name="approvalText" placeholder="موافق" required />

    <div class="error-msg" id="errorMsg" role="alert" aria-live="assertive"></div>

    <div id="approvalNotice" class="notice" style="display:none;"></div>

    <div style="display:flex; justify-content:center; gap: 15px; margin-top: 20px;">
      <button id="finalizeBtn" class="btn-approve">
        <span class="icon">✓</span> إتمام العقد
      </button>
      <button id="rejectBtn" class="btn-reject">
        <span class="icon">×</span> رفض العقد
      </button>
    </div>

    <div id="rejectMsg" role="alert" style="display:none;">
      تم رفض العقد بشكل رسمي. يرجى التواصل مع الممثل القانوني. شكرًا.
    </div>
  </section>

  <!-- الصفحة 5 (النهائية) -->
  <section id="page5" class="page" aria-label="تم إبرام العقد">
    <h2 style="color:#2e7d32; text-align:center; margin-top: 50px; font-weight: 900; font-size: 2rem;">
      تم إبرام العقد بنجاح ✅
    </h2>
  </section>

</div>

<footer aria-live="polite" aria-atomic="true" aria-relevant="text" id="footer">
  ⚠️ تنبيه: هذا العقد يُعد سندًا تنفيذيًا كما نصّت عليه المادة (9) من نظام التعاملات الإلكترونية
</footer>

<script>
  const pages = [...document.querySelectorAll('.page')];
  const footer = document.getElementById('footer');

  function showPage(id) {
    pages.forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    document.getElementById('rejectMsg').style.display = 'none';
    document.getElementById('approvalNotice').style.display = 'none';
    document.getElementById('errorMsg').textContent = '';
  }

  // تحديث التاريخ والوقت بالثواني كل ثانية (للفوتر)
  function updateDateTime() {
    const now = new Date();
    const days = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
    const dayName = days[now.getDay()];
    const date = now.toLocaleDateString('ar-SA', {year: 'numeric', month: '2-digit', day: '2-digit'});
    const time = now.toLocaleTimeString('ar-SA', {hour12: false});
    footer.textContent = `⚠️ تنبيه: هذا العقد يُعد سندًا تنفيذيًا كما نصّت عليه المادة (9) من نظام التعاملات الإلكترونية
اليوم: ${dayName} - التاريخ: ${date} - الوقت: ${time}`;

    // أيضاً تحديث الوقت داخل الحقول الخاصة بالعقد (في الصفحة 3)
    const contractTimeFields = document.querySelectorAll('.contract-time');
    contractTimeFields.forEach(el => {
      el.textContent = time;
    });
    const contractDateFields = document.querySelectorAll('.contract-date');
    contractDateFields.forEach(el => {
      el.textContent = date;
    });
    const contractDayFields = document.querySelectorAll('.contract-day');
    contractDayFields.forEach(el => {
      el.textContent = dayName;
    });
  }
  setInterval(updateDateTime, 1000);
  updateDateTime();

  // الصفحة 1 -> 2
  document.getElementById('startBtn').addEventListener('click', () => {
    showPage('page2');
    document.getElementById('fullName').focus();
  });

  // تحقق الصفحة 2 (الاسم الكريم ورقم الهوية 10 أرقام)
  const fullNameInput = document.getElementById('fullName');
  const idNumberInput = document.getElementById('idNumber');
  const toContractBtn = document.getElementById('toContractBtn');

  function validatePage2() {
    const nameValid = fullNameInput.value.trim().length > 0;
    const idValid = /^\d{10}$/.test(idNumberInput.value.trim());
    toContractBtn.disabled = !(nameValid && idValid);
  }
  fullNameInput.addEventListener('input', validatePage2);
  idNumberInput.addEventListener('input', validatePage2);

  // الصفحة 2 -> 3: توليد نص العقد مع الحقول الفراغية والتاريخ أونلاين
  toContractBtn.addEventListener('click', () => {
    if (toContractBtn.disabled) return;

    window.clientName = fullNameInput.value.trim();
    window.clientId = idNumberInput.value.trim();

    const now = new Date();
    const approvalDate = new Date(now.getTime() - 21 * 60000);
    const days = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];

    function formatDate(d) {
      const dayName = days[d.getDay()];
      const date = d.toLocaleDateString('ar-SA', {year: 'numeric', month: '2-digit', day: '2-digit'});
      const time = d.toLocaleTimeString('ar-SA', {hour12: false});
      return {dayName, date, time};
    }

    // التاريخ في لحظة الانتقال
    const fDate = formatDate(now);
    const fAppDate = formatDate(approvalDate);

    // نص العقد مع حقول فراغية إدخال (inputs inline)
    // تعبير HTML مركب للنص مع حقول <input>
    const contractHtml = `
بسم الله الرحمن الرحيم

المملكة العربية السعودية
 الوساطة العقارية والتسويق
ترخيص: 1100042624
الرياض


⸻

عقد اتفاقية إنهاء إجراءات تمويل عقاري من جهة تمويلية

تم بعون الله وتوفيقه في يوم <span class="contract-day contract-fill">${fDate.dayName}</span> الموافق <span class="contract-date contract-fill">${fDate.date}</span> هـ، الموافق <span class="contract-date contract-fill">${fDate.date}</span> م، الاتفاق بين كلٍ من:

⸻

الطرف الأول:

شركة الوساطة العقارية والتسويق
ويمثلها في التوقيع على هذا العقد الأستاذ: نايف المطيري………………………………
بصفته: مدير الادارة
ويُشار إليه في هذا العقد بـ (الطرف الأول)

⸻

الطرف الثاني:

الاسم: <span class="contract-fill">${window.clientName}</span>
رقم الهوية: <span class="contract-fill">${window.clientId}</span>
العنوان: <input type="text" class="inline-fill" placeholder="اكتب العنوان هنا" aria-label="العنوان" />
تاريخ الميلاد: <input type="text" class="inline-fill" placeholder="مثلاً 1400/01/01" aria-label="تاريخ الميلاد" />
رقم الجوال: <input type="text" class="inline-fill" placeholder="05xxxxxxxx" aria-label="رقم الجوال" />

ويُشار إليه في هذا العقد بـ (الطرف الثاني)

⸻

التمهيد:

حيثُ أن الطرف الأول وساطة عقارية مرخصة بالوساطة العقارية وشراء وبيع العقارات، وتقوم بخدمة عملائها بتوفير العقار المناسب بناء على طلبهم، وتيسير حصولهم على تمويل مالي يمكنهم من تملّك العقار  ، وذلك بأي من برامج المرابحة أو الإجارة المنتهية بالتمليك المعتمدة من الهيئات الشرعية لدى البنوك والجهات التمويلية،ولخبرة الطرف الاول فقد اوكل الطرف الثاني هذي المهمة.
ولما كان الطرف الثاني يرغب في تملّك العقار حدده الطرف الثاني، فقد قام الطرف الأول بتسهيل كل ما من شأنه حصول الطرف الثاني على العقار المطلوب، وذلك بعمل جميع الإجراءات والمفاوضات مع مالك العقار، والجهات الممولة ومعرفة عروضها والحلول الممكنة لإنجاز الطرف الثاني، والجهات المقيمة للعقار لسرعة التقييم .

وعليه فقد اتفق الطرفان – بكامل الأهلية الشرعية والنظامية – على ما يلي:

⸻

البنود:

1. يعتبر التمهيد المذكور أعلاه جزء لا يتجزأ من هذا العقد ويُقرأ معه ويفسّر كوحدة واحدة.

2. يقوم الطرف الأول بإتمام جميع الإجراءات والمفاوضات المتعلقة بالعقار المحدد من قبل الطرف الثاني، لإتمام الصفقة لصالح الطرف الثاني من الجهة التمويلية المعتمدة لدى الطرف الأول.

3. يلتزم الطرف الثاني بدفع مبلغ قدره نسبة2.5% قيمة العقار+500﷼ رسوم عقد ريال للطرف الأول،  مقابل قيام الطرف الأول بالوفاء بجميع التزاماته.

4. في حال عدم إتمام الصفقة لسبب لا يعود للطرف الثاني، مثل رجوع مالك العقار عن البيع، أو ظهور عيوب في العقار، أو عدم موافقة البنك، فإن الطرف الأول يلتزم بإعادة المبلغ المدفوع للطرف الثاني اذا كان مدفوع مقدما بسند قبض او بيصال من البنك.

5. في حال رجوع الطرف الثاني عن إبرام الصفقة لأي سبب يعود له، فإن