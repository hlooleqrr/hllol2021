<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>سرعة تملك العقار</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0; padding: 0;
      height: 100%;
      font-family: 'Tajawal', sans-serif;
      background: #f9fafb;
      color: #002c27;
      direction: rtl;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 480px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 0 12px rgba(0,0,0,0.08);
      border-radius: 8px;
      overflow: hidden;
    }

    header {
      background: #004d40;
      color: #e0f7f1;
      padding: 25px 20px 20px 20px;
      font-size: 1.7rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.05em;
      user-select: none;
    }

    main {
      flex: 1;
      padding: 20px 25px 80px 25px;
      overflow-y: auto;
      position: relative;
    }

    footer {
      height: 50px;
      line-height: 50px;
      background: #e0f7f1;
      color: #004d40;
      font-weight: 600;
      font-size: 0.95rem;
      text-align: center;
      position: relative;
      user-select: none;
      border-top: 1px solid #b2dfdb;
    }

    /* صفحة 1 */
    #page1 h1 {
      font-size: 2.3rem;
      margin-bottom: 15px;
      font-weight: 800;
      color: #004d40;
      text-shadow: 1px 1px 2px rgba(0,77,64,0.4);
    }
    #page1 .welcome {
      font-size: 1.25rem;
      margin-bottom: 25px;
      color: #00796b;
      font-weight: 600;
      text-align: center;
    }
    #page1 .contract-intro {
      font-size: 1.1rem;
      margin-bottom: 10px;
      font-weight: 600;
      text-align: center;
      color: #004d40;
    }
    #page1 .start-phrase {
      font-size: 1.1rem;
      font-style: italic;
      text-align: center;
      color: #004d40;
    }

    /* صفحة 2 */
    #page2 form {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-top: 20px;
    }
    #page2 input[type="text"] {
      font-size: 1.2rem;
      padding: 12px 15px;
      border-radius: 6px;
      border: 1.5px solid #004d40;
      outline: none;
      transition: border-color 0.3s ease;
    }
    #page2 input[type="text"]:focus {
      border-color: #00796b;
      box-shadow: 0 0 6px rgba(0,121,107,0.4);
    }

    #page2 button {
      background: #00796b;
      color: white;
      font-size: 1.25rem;
      padding: 14px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.06em;
      transition: background 0.3s ease;
    }
    #page2 button:hover {
      background: #004d40;
    }

    /* صفحة 3 */
    #page3 {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #page3 .contract-text {
      flex: 1;
      overflow-y: auto;
      font-size: 1.05rem;
      line-height: 1.55;
      color: #004d40;
      padding: 10px 15px;
      border: 1px solid #004d40;
      border-radius: 8px;
      margin-bottom: 20px;
      background: #f0f7f5;
      user-select: text;
      white-space: pre-wrap;
    }
    #page3 .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    #page3 button {
      flex: 1;
      font-size: 1.15rem;
      font-weight: 700;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
      user-select: none;
    }
    #approveFirstBtn {
      background: #00796b;
      color: white;
    }
    #approveFirstBtn:hover {
      background: #004d40;
    }
    #secondPartyAction {
      margin-top: 15px;
      display: none;
      justify-content: center;
      gap: 15px;
    }
    #secondPartyAction button {
      background: #004d40;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
    }
    #secondPartyAction button:hover {
      background: #00796b;
    }
    #timeBeforeLabel {
      font-size: 0.9rem;
      color: #004d40;
      margin-bottom: 10px;
      font-weight: 600;
      text-align: center;
      user-select: none;
    }

    /* صفحة 4 */
    #page4 form {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-top: 10px;
    }
    #page4 input[type="text"] {
      font-size: 1.2rem;
      padding: 12px 15px;
      border-radius: 6px;
      border: 1.5px solid #004d40;
      outline: none;
      transition: border-color 0.3s ease;
    }
    #page4 input[type="text"]:focus {
      border-color: #00796b;
      box-shadow: 0 0 6px rgba(0,121,107,0.4);
    }
    #page4 button {
      background: #00796b;
      color: white;
      font-size: 1.25rem;
      padding: 14px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.06em;
      transition: background 0.3s ease;
    }
    #page4 button:hover {
      background: #004d40;
    }
    #successMessage {
      font-size: 1.3rem;
      font-weight: 800;
      color: #00796b;
      text-align: center;
      margin-top: 20px;
      user-select: none;
    }

    /* تنسيقات مشتركة */
    .hidden {
      display: none !important;
    }
    /* Scrollbar for contract text */
    #page3 .contract-text::-webkit-scrollbar {
      width: 8px;
    }
    #page3 .contract-text::-webkit-scrollbar-thumb {
      background-color: #00796b;
      border-radius: 4px;
    }
    #page3 .contract-text::-webkit-scrollbar-track {
      background: #e0f7f1;
    }

  </style>
</head>
<body>
  <div id="app">

    <header>سرعة تملك العقار والحلول التمويلية المتكاملة</header>

    <main>
      <!-- الصفحة 1 -->
      <section id="page1">
        <h1>سرعة تملك العقار والحلول التمويلية المتكاملة</h1>
        <div class="welcome">نرحب بك عميلنا العزيز</div>
        <div class="contract-intro">نبرم معك هذا العقد</div>
        <div class="start-phrase">ابدأ بسم الله</div>
        <div style="margin-top:40px; text-align:center;">
          <button id="goToPage2" style="background:#00796b; color:#fff; padding:14px 28px; border:none; border-radius:8px; font-size:1.25rem; font-weight:700; cursor:pointer;">ابدأ</button>
        </div>
      </section>

      <!-- الصفحة 2 -->
      <section id="page2" class="hidden">
        <form id="formPage2" autocomplete="off" novalidate>
          <input type="text" id="clientName" name="clientName" placeholder="الاسم الكريم" required minlength="2" />
          <input type="text" id="clientID" name="clientID" placeholder="السجل المدني" required pattern="\\d{10,12}" title="ادخل رقم السجل المدني صحيح" />
          <button type="submit">التالي</button>
        </form>
      </section>

      <!-- الصفحة 3 -->
      <section id="page3" class="hidden">
        <div id="timeBeforeLabel"></div>
        <div class="contract-text" id="contractText" tabindex="0" aria-label="نص العقد"></div>
        <div class="action-buttons">
          <button id="approveFirstBtn">موافقة الطرف الأول</button>
        </div>
        <div id="secondPartyAction" aria-live="polite" role="region">
          <button id="secondApproveBtn">موافقة الطرف الثاني</button>
          <button id="secondRejectBtn" style="background:#d32f2f;">رفض الطرف الثاني</button>
        </div>
      </section>

      <!-- الصفحة 4 -->
      <section id="page4" class="hidden">
        <form id="formPage4" autocomplete="off" novalidate>
          <input type="text" id="confirmID" name="confirmID" placeholder="رقم الهوية" required pattern="\\d{10,12}" title="ادخل رقم الهوية صحيح" />
          <input type="text" id="confirmText" name="confirmText" placeholder="اكتب كلمة (موافق)" required pattern="^(موافق|موافقة|موافقاً)$" title='اكتب كلمة "موافق" بالضبط' />
          <button type="submit">تأكيد</button>
        </form>
        <div id="successMessage" class="hidden">تم إبرام العقد بنجاح ✅</div>
      </section>
    </main>

    <footer id="footerDateTime">
      <!-- التاريخ والوقت يُعرض هنا -->
    </footer>

  </div>

<script>
  (() => {
    // العناصر
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    const page3 = document.getElementById('page3');
    const page4 = document.getElementById('page4');
    const footerDateTime = document.getElementById('footerDateTime');

    const goToPage2Btn = document.getElementById('goToPage2');
    const formPage2 = document.getElementById('formPage2');
    const formPage4 = document.getElementById('formPage4');

    const contractTextEl = document.getElementById('contractText');
    const timeBeforeLabel = document.getElementById('timeBeforeLabel');
    const approveFirstBtn = document.getElementById('approveFirstBtn');
    const secondPartyAction = document.getElementById('secondPartyAction');
    const secondApproveBtn = document.getElementById('secondApproveBtn');
    const secondRejectBtn = document.getElementById('secondRejectBtn');

    const confirmID = document.getElementById('confirmID');
    const confirmText = document.getElementById('confirmText');
    const successMessage = document.getElementById('successMessage');

    // بيانات العميل
    let clientName = '';
    let clientID = '';

    // تحديث التاريخ والوقت في الفوتر كل ثانية
    function updateFooterDateTime() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const dateStr = now.toLocaleDateString('ar-SA', options);
      const timeStr = now.toLocaleTimeString('ar-SA');
      footerDateTime.textContent = `التاريخ: ${dateStr} | الوقت: ${timeStr}`;
    }
    setInterval(updateFooterDateTime, 1000);
    updateFooterDateTime();

    // تبديل عرض الصفحات
    function showPage(pageToShow) {
      [page1, page2, page3, page4].forEach(p => p.classList.add('hidden'));
      pageToShow.classList.remove('hidden');
      // وضع التركيز للولوجية
      if(pageToShow.querySelector('input, button')) {
        pageToShow.querySelector('input, button').focus();
      }
    }

    // نص العقد مع دمج اسم العميل (طرف ثاني)
    function getContractText(name) {
      return `
بسم الله الرحمن الرحيم

نبرم نحن:

الطرف الأول: شركة سرعة تملك العقار والحلول التمويلية المتكاملة

الطرف الثاني: السيد / ${name} (المشار إليه فيما بعد بـ "الطرف الثاني")

بموجب هذا العقد يتعهد الطرف الأول بإنهاء كافة إجراءات التمويل العقاري الخاصة بالطرف الثاني حسب الشروط والأحكام التالية:

1. يلتزم الطرف الثاني بتقديم كافة المستندات المطلوبة لإتمام إجراءات التمويل.
2. يتحمل الطرف الثاني كافة الرسوم المتعلقة بإجراءات التمويل المتفق عليها مسبقًا.
3. يُعتبر هذا العقد نافذًا بمجرد توقيع الطرفين أو إقرار الطرف الثاني بالموافقة على الشروط عبر الموقع.
4. يقر الطرف الثاني بأن الموافقة الإلكترونية تمثل توقيعًا قانونيًا ملزمًا.
5. يحق للطرف الأول إلغاء العقد في حال عدم التزام الطرف الثاني بالشروط دون إشعار مسبق.
6. يلتزم الطرف الأول بالحفاظ على سرية معلومات الطرف الثاني وعدم إفشائها لأي جهة خارجية.
7. يلتزم الطرف الثاني بدفع الرسوم المستحقة عند إتمام إجراءات التمويل كما هو متفق عليه.
8. تسري أحكام الشريعة الإسلامية في حال وجود أي نزاع يتعلق بهذا العقد.
9. يتعهد الطرفان بالتعاون لإنهاء كافة إجراءات التمويل بأسرع وقت ممكن.
10. في حال وجود خلاف، يتم حله وديًا بين الطرفين، وفي حال التعذر يُحال للنظر في الجهات القضائية المختصة.
11. هذا العقد مبرم إلكترونيًا ويُعتبر مُلزمًا للطرفين.
12. توقيع الطرف الثاني عبر الموقع الإلكتروني يُعتبر قبولًا صريحًا وملزمًا بكافة شروط هذا العقد.

**نهاية العقد**
      `.trim();
    }

    // الوقت الحالي - 21 دقيقة (للطرف الأول)
    function getTimeMinus21Minutes() {
      const now = new Date();
      now.setMinutes(now.getMinutes() - 21);
      return now;
    }

    // صياغة الوقت والتاريخ بالعربية
    function formatDateTimeArabic(dt) {
      const optionsDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
      const dateStr = dt.toLocaleDateString('ar-SA', optionsDate);
      const timeStr = dt.toLocaleTimeString('ar-SA', optionsTime);
      return `${dateStr} | الساعة: ${timeStr}`;
    }

    // صفحة 1: زر ابدأ
    goToPage2Btn.addEventListener('click', () => {
      showPage(page2);
    });

    // صفحة 2: تحقق من الاسم والسجل المدني
    formPage2.addEventListener('submit', e => {
      e.preventDefault();
      const nameVal = formPage2.clientName.value.trim();
      const idVal = formPage2.clientID.value.trim();

      if (nameVal.length < 2) {
        alert('الرجاء إدخال الاسم الكريم بشكل صحيح.');
        return;
      }
      const idPattern = /^\d{10,12}$/;
      if (!idPattern.test(idVal)) {
        alert('الرجاء إدخال رقم السجل المدني صحيح (10 إلى 12 رقم).');
        return;
      }

      clientName = nameVal;
      clientID = idVal;

      // عرض العقد مع دمج الاسم
      contractTextEl.textContent = getContractText(clientName);

      // عرض وقت الطرف الأول (الوقت الحالي - 21 دقيقة)
      const timeMinus21 = getTimeMinus21Minutes();
      timeBeforeLabel.textContent = `موافقة الطرف الأول بتاريخ ووقت قبل: ${formatDateTimeArabic(timeMinus21)}`;

      showPage(page3);
    });

    // صفحة 3: الطرف الأول يوافق
    approveFirstBtn.addEventListener('click', () => {
      approveFirstBtn.disabled = true;
      secondPartyAction.style.display = 'flex';
      approveFirstBtn.style.display = 'none';
    });

    // الطرف الثاني يرفض
    secondRejectBtn.addEventListener('click', () => {
      alert('تم رفض العقد بشكل رسمي