<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>الخطوة 1 - بيانات العميل</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f9f9f9;
      padding: 20px;
      color: #004d40;
    }
    .container {
      max-width: 650px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      border: 2px solid #004d40;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      margin-top: 5px;
      margin-bottom: 10px;
      border: 2px solid #009688;
      font-size: 1rem;
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      background: #00796b;
      color: white;
      font-size: 1.1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #004d40;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>الخطوة 1: البيانات الأساسية</h2>

    <label>الاسم الكامل:</label>
    <input type="text" id="name" placeholder="مثال: محمد بن نايف" />

    <label>رقم السجل المدني:</label>
    <input type="text" id="id" placeholder="10 أرقام" maxlength="10" />

    <div id="addressInput" class="hidden">
      <label>العنوان (إذا لم يُلتقط الموقع):</label>
      <input type="text" id="address" placeholder="مثال: الرياض، حي العليا" />
    </div>

    <button id="nextBtn" disabled>التالي ➔</button>
  </div>

  <script>
    const nameInput = document.getElementById('name');
    const idInput = document.getElementById('id');
    const addressInput = document.getElementById('address');
    const addressSection = document.getElementById('addressInput');
    const nextBtn = document.getElementById('nextBtn');

    let client = {
      name: '',
      id: '',
      address: ''
    };

    function validate() {
      const name = nameInput.value.trim();
      const id = idInput.value.trim();
      const isIdValid = /^\d{10}$/.test(id);
      const isManual = !client.address;
      const manualOk = !isManual || addressInput.value.trim();
      nextBtn.disabled = !(name && isIdValid && manualOk);
    }

    nameInput.addEventListener('input', validate);
    idInput.addEventListener('input', validate);
    addressInput.addEventListener('input', validate);

    function tryLocation() {
      if (!navigator.geolocation) {
        addressSection.classList.remove('hidden');
        return;
      }

      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude.toFixed(5);
          const lon = pos.coords.longitude.toFixed(5);
          client.address = `إحداثيات: ${lat}, ${lon}`;
          addressSection.classList.add('hidden');
          validate();
        },
        () => {
          addressSection.classList.remove('hidden');
        },
        { timeout: 5000 }
      );
    }

    nameInput.addEventListener('blur', tryLocation);

    nextBtn.addEventListener('click', () => {
      client.name = nameInput.value.trim();
      client.id = idInput.value.trim();
      if (!client.address) client.address = addressInput.value.trim();
      localStorage.setItem('client-step1', JSON.stringify(client));
      window.location.href = 'step2.html';
    });
  </script>
</body>
</html>